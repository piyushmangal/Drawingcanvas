<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile-Friendly Drawing Canvas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* This is a key improvement for mobile: it prevents the page
           from scrolling when you are drawing on the canvas. */
        #drawingCanvas {
            touch-action: none;
        }
        /* Custom styles for range input to ensure visibility and better UX */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #4a5568; /* bg-gray-700 */
            border-radius: 9999px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4299e1; /* A nice blue */
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #edf2f7; /* bg-gray-200 */
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4299e1;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #edf2f7;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4 antialiased">

    <div class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-4 sm:p-6 flex flex-col gap-4">
        
        <!-- Header -->
        <header class="text-center">
            <h1 class="text-2xl sm:text-3xl font-bold text-cyan-400">Crisp Drawing Canvas</h1>
            <p class="text-sm sm:text-base text-gray-400 mt-1">Draw sharp lines at your screen's native resolution.</p>
        </header>

        <!-- Controls Section - Now with a wrapping layout for mobile -->
        <div id="controls" class="bg-gray-700/50 p-4 rounded-xl flex flex-row flex-wrap items-center justify-center gap-x-6 gap-y-4">
            
            <!-- Brush Size Slider -->
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 flex-shrink-0"><path d="M12 5h9"></path><path d="M12 19h9"></path><path d="M12 12h9"></path><path d="M2.5 17a2.5 2.5 0 0 1 0-5 .5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5z"></path><path d="M4 19a1 1 0 0 1-2 0v-1a1 1 0 0 1 2 0v1zM2.5 12a2.5 2.5 0 0 0 0-5 .5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5z"></path><path d="M4 5a1 1 0 0 0-2 0v1a1 1 0 0 0 2 0v-1z"></path></svg>
                <input type="range" id="brushSize" min="1" max="100" value="10" class="w-32 cursor-pointer">
                <span id="brushSizeValue" class="text-sm font-semibold w-10 text-center bg-gray-600 rounded-md py-1">10</span>
            </div>
            
            <!-- Brush Color Picker -->
            <div class="flex items-center gap-3">
                <label for="brushColor" class="text-sm font-medium sr-only">Color</label>
                <input type="color" id="brushColor" value="#06b6d4" class="w-10 h-10 p-1 bg-gray-700 rounded-lg cursor-pointer border-2 border-gray-600">
                <span class="text-gray-300">Brush Color</span>
            </div>
            
            <!-- Tool Toggles -->
            <div class="flex items-center gap-1 bg-gray-800 p-1 rounded-lg">
                <button id="brushButton" class="tool-btn bg-cyan-500 text-white flex items-center gap-2 py-1 px-3 rounded-md transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stroke-current"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path></svg>
                    <span>Brush</span>
                </button>
                <button id="eraserButton" class="tool-btn hover:bg-gray-600 text-gray-300 flex items-center gap-2 py-1 px-3 rounded-md transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stroke-current"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21H7Z"></path><path d="M22 21H7"></path></svg>
                    <span>Eraser</span>
                </button>
            </div>

            <!-- Clear Button -->
            <button id="clearButton" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-all duration-200 ease-in-out transform hover:scale-105">Clear</button>
        </div>

        <!-- Canvas -->
        <div class="relative w-full aspect-video bg-gray-900 rounded-lg overflow-hidden border-2 border-gray-700 shadow-inner">
            <canvas id="drawingCanvas" class="absolute top-0 left-0 w-full h-full"></canvas>
        </div>

        <!-- Resolution Info -->
        <footer class="text-center text-xs text-gray-500">
            <p>Canvas Resolution: <span id="resolutionInfo" class="font-mono">...</span></p>
        </footer>
    </div>

    <script>
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const resolutionInfo = document.getElementById('resolutionInfo');

        const brushSizeSlider = document.getElementById('brushSize');
        const brushSizeValue = document.getElementById('brushSizeValue');
        const brushColorPicker = document.getElementById('brushColor');
        const clearButton = document.getElementById('clearButton');
        const brushButton = document.getElementById('brushButton');
        const eraserButton = document.getElementById('eraserButton');

        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentMode = 'brush'; // 'brush' or 'eraser'

        // --- Core High-Resolution Fix ---
        // This function sets the canvas's internal resolution to match the screen's
        // pixel density, preventing blurriness.
        function resizeCanvas() {
            // Save the current drawing to re-apply it after resize
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

            // Get the device pixel ratio, falling back to 1.
            const dpr = window.devicePixelRatio || 1;
            
            // Get the size the canvas is displayed in CSS pixels.
            const rect = canvas.getBoundingClientRect();

            // Set the canvas's actual drawing buffer size by multiplying
            // the CSS size by the device pixel ratio.
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;

            // Scale the drawing context to ensure that drawing commands
            // are scaled correctly. This allows us to use the same coordinates
            // as if we were on a 1x display.
            ctx.scale(dpr, dpr);
            
            // Re-apply drawing styles that can be reset on resize.
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineWidth = brushSizeSlider.value; // Ensure brush size is consistent
            if (currentMode === 'eraser') {
                // Set eraser color to the canvas container's background color
                ctx.strokeStyle = window.getComputedStyle(canvas.parentElement).backgroundColor;
            } else {
                ctx.strokeStyle = brushColorPicker.value; // Ensure color is consistent
            }

            // Restore the drawing
            // Note: This simple method may not perfectly align the old drawing.
            // A more complex solution would involve re-drawing from a stored path.
            // For now, we clear it to avoid a distorted image on resize.
            // If you want to restore content, you would use:
            // ctx.putImageData(imageData, 0, 0); but this will be scaled incorrectly.
            // Best practice for this app is to just clear on resize.

            // Update the resolution info display.
            resolutionInfo.textContent = `${canvas.width}px x ${canvas.height}px (DPR: ${dpr.toFixed(2)})`;
        }

        // --- Drawing Logic ---
        function getCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            // Handle both mouse and touch events
            const clientX = e.clientX || e.touches[0].clientX;
            const clientY = e.clientY || e.touches[0].clientY;
            return [clientX - rect.left, clientY - rect.top];
        }

        function startDrawing(e) {
            e.preventDefault();
            isDrawing = true;
            [lastX, lastY] = getCoordinates(e);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            
            const [currentX, currentY] = getCoordinates(e);

            ctx.lineWidth = brushSizeSlider.value;
            if (currentMode === 'eraser') {
                ctx.strokeStyle = window.getComputedStyle(canvas.parentElement).backgroundColor;
            } else {
                ctx.strokeStyle = brushColorPicker.value;
            }
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            
            [lastX, lastY] = [currentX, currentY];
        }

        function stopDrawing() {
            isDrawing = false;
        }

        // --- Event Listeners ---

        // Mouse events
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseleave', stopDrawing);

        // Touch events for mobile support
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);

        // Control listeners
        brushSizeSlider.addEventListener('input', (e) => {
            brushSizeValue.textContent = e.target.value;
        });

        clearButton.addEventListener('click', () => {
            // Get the un-scaled dimensions for clearing the canvas
            const rect = canvas.getBoundingClientRect();
            ctx.clearRect(0, 0, rect.width, rect.height);
        });

        function setActiveTool(tool) {
            currentMode = tool;
            if (tool === 'brush') {
                brushButton.classList.add('bg-cyan-500', 'text-white');
                brushButton.classList.remove('hover:bg-gray-600', 'text-gray-300');
                eraserButton.classList.remove('bg-cyan-500', 'text-white');
                eraserButton.classList.add('hover:bg-gray-600', 'text-gray-300');
            } else if (tool === 'eraser') {
                eraserButton.classList.add('bg-cyan-500', 'text-white');
                eraserButton.classList.remove('hover:bg-gray-600', 'text-gray-300');
                brushButton.classList.remove('bg-cyan-500', 'text-white');
                brushButton.classList.add('hover:bg-gray-600', 'text-gray-300');
            }
        }

        brushButton.addEventListener('click', () => setActiveTool('brush'));
        eraserButton.addEventListener('click', () => setActiveTool('eraser'));

        // --- Initialization ---

        // Resize the canvas whenever the window is resized.
        window.addEventListener('resize', resizeCanvas);
        
        // Initial call to set the correct size when the page loads.
        window.addEventListener('load', resizeCanvas);

    </script>
</body>
</html>


